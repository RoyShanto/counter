<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Counter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
</head>

<body class="bg-gray-100 min-h-screen md:py-3 md:px-10 max-sm:p-3">
    <!-- LOGIN SCREEN -->
    <div id="iUSection" class="flex flex-col items-center justify-center h-screen w-full">
        <div class="bg-white shadow-2xl rounded-2xl p-8 w-full max-w-sm text-center">
            <h2 class="text-2xl font-bold text-blue-600 mb-6">üîê Login</h2>

            <div>
                <p class="text-2xl">273 + 548 = ?</p>
                <input id="test" type="text"
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 mb-4 text-center text-lg">
            </div>

            <button onclick="checkLogin()"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2.5 rounded-lg font-bold transition">
                Enter
            </button>
            <p id="loginMessage" class="mt-4 text-gray-700 font-semibold"></p>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <div id="mainContent" class="lg:px-10 mx-auto hidden">
        <h1
            class="md:text-5xl max-sm:text-4xl font-extrabold text-center text-white mb-2 p-3 rounded-lg shadow bg-gradient-to-r from-red-300 to-orange-200">
            Demo Counter
        </h1>
        <p id="today-date" class="text-3xl top-0 right-2 text-gray-500 fixed"></p>
        <div class="text-center flex justify-center space-x-3 text-gray-500">
            <p>0-10=g-600</p>
            <p>11-30=g-400</p>
            <p>31-60=g-200</p>
            <p>61-80=r-200</p>
            <p>81-*=r-400</p>
        </div>

        <!-- Container for all ps -->
        <div id="ps-container" class="space-y-8"></div>

        <!-- Calculator -->
        <div class="md:flex justify-center md:space-x-6 py-5 max-sm:space-y-5">

            <!-- DPS Calculator -->
            <div class="bg-white shadow-lg rounded-2xl p-6">
                <h2 class="text-2xl font-bold text-center text-blue-600 mb-6">
                    DPS Calculator
                </h2>

                <div class="space-y-4">
                    <div class="flex items-center">
                        <label for="deposit" class="w-full  block font-semibold mb-1">Monthly Deposit (‡ß≥)</label>
                        <input type="number" id="deposit" value="5000"
                            class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="e.g. 1000">
                    </div>

                    <div class="flex items-center">
                        <label for="years" class="w-full block font-semibold mb-1">Duration (Years)</label>
                        <input type="number" id="years" value="5"
                            class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="e.g. 5">
                    </div>

                    <div class="flex items-center">
                        <label for="rate" class="w-full block font-semibold mb-1">Annual Interest Rate (%)</label>
                        <input type="number" id="rate" value="10"
                            class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="e.g. 9">
                    </div>

                    <div class="flex items-center">
                        <label for="dpsTax" class="w-full block font-semibold mb-1">Source Tax on Interest (%)</label>
                        <input type="number" id="dpsTax" value="10"
                            class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="e.g. 10">
                    </div>

                    <button onclick="calculateDPS()"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-bold transition">
                        Calculate
                    </button>
                </div>

                <div id="dpsResult" class="mt-6 bg-gray-50 p-4 rounded-lg border border-gray-200 text-gray-800 hidden">
                </div>
            </div>

            <!-- FDR Calculator -->
            <div class="bg-white shadow-lg rounded-2xl p-6">
                <h2 class="text-2xl font-bold text-center text-green-600 mb-6">
                    FDR Calculator
                </h2>

                <div class="space-y-4">
                    <div class="flex items-center">
                        <label for="fdrAmount" class="w-full block font-semibold mb-1">Principal Amount (‡ß≥)</label>
                        <input type="number" id="fdrAmount" value="500000"
                            class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
                            placeholder="e.g. 100000">
                    </div>

                    <div class="flex items-center">
                        <label for="fdrYears" class="w-full block font-semibold mb-1">Duration (Months)</label>
                        <input type="number" id="fdrYears" value="3"
                            class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
                            placeholder="e.g. 3">
                    </div>

                    <div class="flex items-center">
                        <label for="fdrRate" class="w-full block font-semibold mb-1">Annual Interest Rate (%)</label>
                        <input type="number" id="fdrRate" value="9.5"
                            class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
                            placeholder="e.g. 9.5">
                    </div>

                    <div class="flex items-center">
                        <label for="fdrTax" class="w-full block font-semibold mb-1">Source Tax on Interest (%)</label>
                        <input type="number" id="fdrTax" value="15"
                            class="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"
                            placeholder="e.g. 10">
                    </div>

                    <button onclick="calculateFDR()"
                        class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg font-bold transition">
                        Calculate
                    </button>
                </div>

                <div id="fdrResult" class="mt-6 bg-gray-50 p-4 rounded-lg border border-gray-200 text-gray-800 hidden">
                </div>
            </div>
        </div>

        <!-- General Calculator -->
        <button id="openCalculator"
            class="right-2 bottom-1/4 fixed bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700 transition">
            C
        </button>

        <!-- Calculator Modal -->
        <div id="calculatorModal"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div class="bg-white p-2 max-sm:top-[22%] rounded-2xl shadow-xl max-sm:w-full relative">
                <!-- Close Button -->
                <button id="closeCalculator"
                    class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 font-bold">‚úñ</button>

                <div class="shadow-xl rounded-2xl p-6 w-full md:w-[300px] bg-white">
                    <div id="calcDisplay"
                        class="bg-gray-50 border border-gray-300 text-right text-4xl p-4 rounded-xl mb-6 font-semibold text-black tracking-wide overflow-x-auto">
                        0
                    </div>

                    <div class="grid grid-cols-4 gap-3 text-lg font-semibold select-none">
                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="C">C</button>
                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="DEL">‚å´</button>
                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="%">%</button>
                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="/">√∑</button>

                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="7">7</button>
                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="8">8</button>
                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="9">9</button>
                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="*">√ó</button>


                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="4">4</button>
                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="5">5</button>
                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="6">6</button>
                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="-">‚àí</button>


                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="1">1</button>
                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="2">2</button>
                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="3">3</button>
                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val="+">+</button>


                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl col-span-2"
                            data-val="0">0</button>
                        <button class="calc-btn bg-white text-black border border-gray-300 py-4 rounded-xl"
                            data-val=".">.</button>
                        <button class="calc-btn bg-blue-600 text-white border border-gray-300 py-4 rounded-xl"
                            data-val="=">=</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <hr class="lg:mx-10 mt-12">

    <script>

        // Disable right-click
        document.addEventListener('contextmenu', function (e) {
            e.preventDefault();
        });

        // Disable certain keyboard shortcuts
        document.addEventListener('keydown', function (e) {
            // Block F12, Ctrl+Shift+I, and Ctrl+U
            if (e.keyCode === 123 ||
                (e.ctrlKey && e.shiftKey && e.keyCode === 73) ||
                (e.ctrlKey && e.keyCode === 85)) {
                e.preventDefault();
            }
        });



        // LOGIN FUNCTION
        function checkLogin() {
            const iUTest = document.getElementById('test').value.trim();
            const iUSection = document.getElementById('iUSection');
            const mainContent = document.getElementById('mainContent');
            const msg = document.getElementById('loginMessage');

            if (iUTest.toLowerCase() === 'bible') {
                iUSection.classList.add('hidden');
                mainContent.classList.remove('hidden');
            } else if (iUTest === '821') {
                msg.textContent = "WoW...! You Are Right.";
                msg.classList.add("text-green-600");
                msg.classList.remove("text-red-600");
            } else {
                msg.textContent = "Wrong Answer, Try Again...!";
                msg.classList.add("text-red-600");
                msg.classList.remove("text-green-600");
            }
        }

        const investments = [
            { label: '38?45?880*', p: "U", startDate: '2021-01-21', periods: 60, interval: 1 },
            { label: '27?10?646*', p: "O", startDate: '2025-04-28', periods: 12, interval: 3 },
            { label: '27?10?562*', p: "O", startDate: '2025-05-04', periods: 12, interval: 3 },
            { label: '26?10?482*', p: "O", startDate: '2025-08-21', periods: 12, interval: 3 },
            { label: '9?5?828', p: "O", startDate: '2025-01-04', periods: 12, interval: 3 },
            { label: '9?5?828', p: "O", startDate: '2025-01-04', periods: 12, interval: 3 },
            { label: '9?5?828', p: "O", startDate: '2025-01-04', periods: 12, interval: 3 },
            { label: '191125_5BSh', p: "O", startDate: '2025-11-30', periods: 6, interval: 1 },
            { label: '191125_5BSh', p: "O", startDate: '2025-11-30', periods: 6, interval: 1 },
            { label: '191125_5BSh', p: "O", startDate: '2025-11-30', periods: 6, interval: 1 },
            { label: '191125_5BSh', p: "O", startDate: '2025-11-30', periods: 6, interval: 1 },
            { label: '13?5?837*', p: "N", startDate: '2025-05-15', periods: 12, interval: 3 },
            { label: '13?5?269*', p: "N", startDate: '2025-08-17', periods: 12, interval: 3 },
            { label: '52?20?965*', p: "N", startDate: '2025-09-29', periods: 12, interval: 3 },
            { label: '9?5?828', p: "N", startDate: '2025-04-26', periods: 12, interval: 3 },
            { label: '9?5?828', p: "N", startDate: '2025-04-26', periods: 12, interval: 3 },
            { label: '9?5?828', p: "N", startDate: '2025-04-26', periods: 12, interval: 3 }];

        const today = new Date();
        document.getElementById('today-date').innerText = today.toDateString();
        const psContainer = document.getElementById('ps-container');

        // Helper to find next upcoming date and remaining days
        function getNextDateAndDiff(startDate, periods, interval) {
            let date = new Date(startDate);
            date.setMonth(date.getMonth() + interval);
            for (let i = 0; i < periods; i++) {
                // Reset time to midnight to avoid time zone issues
                date.setHours(0, 0, 0, 0);
                today.setHours(0, 0, 0, 0);

                const diffTime = date - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays >= 0) {  // include today as 0
                    return { nextDate: new Date(date), daysLeft: diffDays };
                }
                date.setMonth(date.getMonth() + interval);
            }
            return { nextDate: null, daysLeft: Infinity };
        }

        
        // Add nextDate & daysLeft to each investment
        investments.forEach(inv => {
            const result = getNextDateAndDiff(inv.startDate, inv.periods, inv.interval);
            inv.nextDate = result.nextDate;
            inv.daysLeft = result.daysLeft;
        });

        // Group by p
        const grouped = {};
        investments.forEach(inv => {
            if (!grouped[inv.p]) grouped[inv.p] = [];
            grouped[inv.p].push(inv);
        });

        // Render per p (row-wise)
        Object.keys(grouped).forEach(p => {
            const section = document.createElement('div');
            section.className = "bg-gray-50 rounded-xl md:p-4";

            const header = document.createElement('h2');
            header.className = "text-2xl font-bold mb-4 text-white bg-blue-500 rounded-lg p-2";
            const count = grouped[p].length;
            header.textContent = `${p} (${count})`;
            section.appendChild(header);

            const row = document.createElement('div');
            row.className = "flex flex-wrap max-sm:justify-between gap-2";  // row layout

            // Sort p investments by days left
            grouped[p].sort((a, b) => a.daysLeft - b.daysLeft);

            grouped[p].forEach(inv => {
                const card = document.createElement('div');
                card.className = "bg-white border-4 md:p-4 max-sm:p-3 max-sm:w-[180px] rounded-lg shadow hover:shadow-lg transition-shadow";

                // üé® Add color based on urgency
                if (inv.daysLeft <= 10) {
                    card.classList.add("border-green-600");
                } else if (inv.daysLeft <= 30) {
                    card.classList.add("border-green-400");
                } else if (inv.daysLeft <= 60) {
                    card.classList.add("border-green-200");
                } else if (inv.daysLeft <= 80) {
                    card.classList.add("border-red-200");
                } else {
                    card.classList.add("border-red-400");
                }

                // max-sm:w-40
                const title = document.createElement('h2');
                title.className = "font-bold text-lg mb-2 text-center text-blue-700 bg-blue-100 rounded-lg";
                title.textContent = inv.label;
                card.appendChild(title);

                const countdown = document.createElement('p');
                countdown.className = "text-center text-sm font-semibold text-blue-700 bg-[#f3f4f6] rounded p-1 mb-2";
                countdown.textContent = inv.daysLeft !== Infinity ? `${inv.daysLeft} days left` : "All dates passed";
                card.appendChild(countdown);

                const ol = document.createElement('ol');
                ol.className = "list-decimal list-inside space-y-1 text-sm max-h-32 overflow-y-auto";

                let currentDate = new Date(inv.startDate);
                currentDate.setMonth(currentDate.getMonth() + inv.interval);

                for (let i = 0; i < inv.periods; i++) {
                    const li = document.createElement('li');

                    // normalize currentDate to midnight
                    const normalizedCurrent = new Date(currentDate);
                    normalizedCurrent.setHours(0, 0, 0, 0);

                    li.textContent = currentDate.toDateString();

                    // compare normalized dates
                    if (inv.nextDate && normalizedCurrent.getTime() === inv.nextDate.getTime()) {
                        li.className = "text-orange-500 font-bold";
                    }

                    ol.appendChild(li);
                    currentDate.setMonth(currentDate.getMonth() + inv.interval);
                }


                card.appendChild(ol);
                row.appendChild(card);
            });

            section.appendChild(row);
            psContainer.appendChild(section);
        });




        // Modal
        const openBtn = document.getElementById('openCalculator');
        const closeBtn = document.getElementById('closeCalculator');
        const modal = document.getElementById('calculatorModal');

        openBtn.addEventListener('click', () => modal.classList.remove('hidden'));
        closeBtn.addEventListener('click', () => modal.classList.add('hidden'));

        // General CALCULATION
        const display = document.getElementById("calcDisplay");
        document.querySelectorAll('.calc-btn').forEach(btn => {
            btn.addEventListener('click', () => handleClick(btn.dataset.val));
        });


        function handleClick(val) {
            if (val === "C") {
                display.textContent = "0";
            } else if (val === "DEL") {
                display.textContent = display.textContent.slice(0, -1) || "0";
            } else if (val === "%") {
                let exp = display.textContent;
                let match = exp.match(/(\d+\.?\d*)$/);
                if (match) {
                    let num = parseFloat(match[1]) / 100;
                    display.textContent = exp.replace(/(\d+\.?\d*)$/, num);
                }
            } else if (val === "=") {
                try {
                    display.textContent = eval(display.textContent);
                } catch {
                    display.textContent = "Error";
                }
            } else {
                // Fix leading zero: if display is "0", replace it, else append
                display.textContent = display.textContent === "0" ? val : display.textContent + val;
            }
        }


        // DPS CALCULATION
        function calculateDPS() {
            const P = parseFloat(document.getElementById('deposit').value);
            const t = parseFloat(document.getElementById('years').value);
            const r = parseFloat(document.getElementById('rate').value) / 100;
            const taxRate = parseFloat(document.getElementById('dpsTax').value) / 100 || 0;
            const n = 12;
            const resultDiv = document.getElementById('dpsResult');

            if (isNaN(P) || isNaN(t) || isNaN(r) || P <= 0 || t <= 0 || r <= 0) {
                resultDiv.innerHTML = `<p class='text-red-600 font-semibold'>‚ö†Ô∏è Please enter valid positive numbers.</p>`;
                resultDiv.classList.remove('hidden');
                return;
            }

            const M = P * ((Math.pow((1 + r / n), n * t) - 1) / (r / n)) * (1 + r / n);
            const totalDeposit = P * n * t;
            const interest = M - totalDeposit;

            const taxAmount = interest * taxRate;
            const maturityAfterTax = M - taxAmount;
            const interestAfterTax = M - totalDeposit - taxAmount;

            resultDiv.innerHTML = `
        <p><strong>Total Deposit:</strong> ‡ß≥${totalDeposit.toFixed(2)}</p>
        <p><strong>Interest Earned:</strong> ‡ß≥${interest.toFixed(2)}</p>
        <p><strong>Maturity Amount:</strong> <span class='text-blue-600 font-bold'>‡ß≥${M.toFixed(2)}</span></p>
        <p><strong>Source Tax:</strong> ‡ß≥${taxAmount.toFixed(2)} (${(taxRate * 100).toFixed(1)}%)</p>
        <p><strong>Maturity After Tax:</strong> <span class='text-blue-600 font-bold'>‡ß≥${maturityAfterTax.toFixed(2)}</span></p>
        <p><strong>Interest After Tax:</strong> <span class='text-blue-600 font-bold'>‡ß≥${interestAfterTax.toFixed(2)}</span></p>
      
        `;
            resultDiv.classList.remove('hidden');
        }

        // FDR CALCULATION
        function calculateFDR() {
            const A = parseFloat(document.getElementById('fdrAmount').value);
            const t = parseFloat(document.getElementById('fdrYears').value);
            const r = parseFloat(document.getElementById('fdrRate').value) / 100;
            const taxRate = parseFloat(document.getElementById('fdrTax').value) / 100 || 0;
            const resultDiv = document.getElementById('fdrResult');

            if (isNaN(A) || isNaN(t) || isNaN(r) || A <= 0 || t <= 0 || r <= 0) {
                resultDiv.innerHTML = `<p class='text-red-600 font-semibold'>‚ö†Ô∏è Please enter valid positive numbers.</p>`;
                resultDiv.classList.remove('hidden');
                return;
            }

            // Compound interest for FDR (compounded quarterly as per Bangladesh bank practice)
            const n = 4;
            const maturity = A * Math.pow(1 + r / n, n * (t / 12));
            const interest = maturity - A;

            const taxAmount = interest * taxRate;
            const maturityAfterTax = maturity - taxAmount;
            const interestAfterTax = maturity - taxAmount - A;

            resultDiv.innerHTML = `
        <p><strong>Principal:</strong> ‡ß≥${A.toFixed(2)}</p>
        <p><strong>Interest Earned:</strong> ‡ß≥${interest.toFixed(2)}</p>
        <p><strong>Maturity Amount:</strong> <span class='text-green-600 font-bold'>‡ß≥${maturity.toFixed(2)}</span></p>
        <p><strong>Source Tax:</strong> ‡ß≥${taxAmount.toFixed(2)} (${(taxRate * 100).toFixed(1)}%)</p>
        <p><strong>Maturity After Tax:</strong> ‡ß≥${maturityAfterTax.toFixed(2)}</p>
        <p><strong>Interest After Tax:</strong> <span class='text-green-600 font-bold'>‡ß≥${interestAfterTax.toFixed(2)}</span></p>
      `;
            resultDiv.classList.remove('hidden');
        }
    </script>
</body>

</html>